{
  "query": "\n-- 设备台账表\nCREATE TABLE IF NOT EXISTS devices (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  deviceId VARCHAR(64) NOT NULL UNIQUE,\n  name VARCHAR(100) NOT NULL,\n  type ENUM('agv', 'rtg', 'qc', 'asc', 'conveyor', 'pump', 'motor', 'sensor_hub', 'gateway', 'other') DEFAULT 'other' NOT NULL,\n  model VARCHAR(100),\n  manufacturer VARCHAR(100),\n  serialNumber VARCHAR(100),\n  location VARCHAR(255),\n  department VARCHAR(100),\n  status ENUM('online', 'offline', 'maintenance', 'error', 'unknown') DEFAULT 'unknown' NOT NULL,\n  lastHeartbeat TIMESTAMP NULL,\n  installDate TIMESTAMP NULL,\n  warrantyExpiry TIMESTAMP NULL,\n  metadata JSON,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL\n);\n\n-- 传感器表\nCREATE TABLE IF NOT EXISTS sensors (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  sensorId VARCHAR(64) NOT NULL UNIQUE,\n  deviceId VARCHAR(64) NOT NULL,\n  name VARCHAR(100) NOT NULL,\n  type ENUM('vibration', 'temperature', 'pressure', 'current', 'voltage', 'speed', 'position', 'humidity', 'flow', 'level', 'other') DEFAULT 'other' NOT NULL,\n  unit VARCHAR(20),\n  minValue INT,\n  maxValue INT,\n  warningThreshold INT,\n  criticalThreshold INT,\n  samplingRate INT DEFAULT 1000,\n  status ENUM('active', 'inactive', 'error') DEFAULT 'active' NOT NULL,\n  lastValue VARCHAR(50),\n  lastReadingAt TIMESTAMP NULL,\n  metadata JSON,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL\n);\n\n-- 遥测数据表\nCREATE TABLE IF NOT EXISTS sensor_readings (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  sensorId VARCHAR(64) NOT NULL,\n  deviceId VARCHAR(64) NOT NULL,\n  value VARCHAR(50) NOT NULL,\n  numericValue INT,\n  quality ENUM('good', 'uncertain', 'bad') DEFAULT 'good' NOT NULL,\n  timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  metadata JSON,\n  INDEX idx_sensor_time (sensorId, timestamp),\n  INDEX idx_device_time (deviceId, timestamp)\n);\n\n-- 聚合数据表\nCREATE TABLE IF NOT EXISTS sensor_aggregates (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  sensorId VARCHAR(64) NOT NULL,\n  deviceId VARCHAR(64) NOT NULL,\n  period ENUM('1m', '5m', '1h', '1d') NOT NULL,\n  periodStart TIMESTAMP NOT NULL,\n  avgValue INT,\n  minValue INT,\n  maxValue INT,\n  sumValue INT,\n  count INT DEFAULT 0 NOT NULL,\n  stdDev INT,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  INDEX idx_sensor_period (sensorId, period, periodStart)\n);\n\n-- 事件日志表\nCREATE TABLE IF NOT EXISTS event_logs (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  eventId VARCHAR(64) NOT NULL UNIQUE,\n  topic VARCHAR(100) NOT NULL,\n  eventType VARCHAR(50) NOT NULL,\n  source VARCHAR(100),\n  deviceId VARCHAR(64),\n  sensorId VARCHAR(64),\n  severity ENUM('info', 'warning', 'error', 'critical') DEFAULT 'info' NOT NULL,\n  payload JSON,\n  processed BOOLEAN DEFAULT FALSE NOT NULL,\n  processedAt TIMESTAMP NULL,\n  processedBy VARCHAR(100),\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  INDEX idx_topic (topic),\n  INDEX idx_device (deviceId),\n  INDEX idx_severity (severity)\n);\n\n-- 异常检测结果表\nCREATE TABLE IF NOT EXISTS anomaly_detections (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  detectionId VARCHAR(64) NOT NULL UNIQUE,\n  sensorId VARCHAR(64) NOT NULL,\n  deviceId VARCHAR(64) NOT NULL,\n  algorithmType ENUM('zscore', 'iqr', 'mad', 'isolation_forest', 'custom') DEFAULT 'zscore' NOT NULL,\n  windowSize INT DEFAULT 60,\n  threshold INT,\n  currentValue INT,\n  expectedValue INT,\n  deviation INT,\n  score INT,\n  severity ENUM('low', 'medium', 'high', 'critical') DEFAULT 'low' NOT NULL,\n  status ENUM('open', 'acknowledged', 'resolved', 'false_positive') DEFAULT 'open' NOT NULL,\n  acknowledgedBy VARCHAR(100),\n  acknowledgedAt TIMESTAMP NULL,\n  resolvedAt TIMESTAMP NULL,\n  notes TEXT,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  INDEX idx_sensor (sensorId),\n  INDEX idx_status (status),\n  INDEX idx_severity (severity)\n);\n\n-- 诊断规则表\nCREATE TABLE IF NOT EXISTS diagnosis_rules (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  ruleId VARCHAR(64) NOT NULL UNIQUE,\n  name VARCHAR(200) NOT NULL,\n  description TEXT,\n  category VARCHAR(50),\n  deviceType VARCHAR(50),\n  sensorType VARCHAR(50),\n  conditionExpr TEXT NOT NULL,\n  actionType ENUM('alert', 'notification', 'workflow', 'auto_fix') DEFAULT 'alert' NOT NULL,\n  actionConfig JSON,\n  severity ENUM('low', 'medium', 'high', 'critical') DEFAULT 'medium' NOT NULL,\n  isActive BOOLEAN DEFAULT TRUE NOT NULL,\n  priority INT DEFAULT 5,\n  triggerCount INT DEFAULT 0,\n  lastTriggeredAt TIMESTAMP NULL,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL\n);\n\n-- 诊断任务表\nCREATE TABLE IF NOT EXISTS diagnosis_tasks (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  taskId VARCHAR(64) NOT NULL UNIQUE,\n  deviceId VARCHAR(64),\n  sensorId VARCHAR(64),\n  ruleId VARCHAR(64),\n  anomalyId VARCHAR(64),\n  taskType ENUM('routine', 'anomaly', 'manual', 'scheduled') DEFAULT 'routine' NOT NULL,\n  status ENUM('pending', 'running', 'completed', 'failed', 'cancelled') DEFAULT 'pending' NOT NULL,\n  priority INT DEFAULT 5,\n  inputData JSON,\n  result JSON,\n  error TEXT,\n  startedAt TIMESTAMP NULL,\n  completedAt TIMESTAMP NULL,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  INDEX idx_device (deviceId),\n  INDEX idx_status (status)\n);\n",
  "command": "mysql --batch --raw --column-names --default-character-set=utf8mb4 --host gateway03.us-east-1.prod.aws.tidbcloud.com --port 4000 --user 2aAMmqBppocQapr.371334c61bab --database Yf7nNWn9GkFGdXXjzFJzEd --execute \n-- 设备台账表\nCREATE TABLE IF NOT EXISTS devices (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  deviceId VARCHAR(64) NOT NULL UNIQUE,\n  name VARCHAR(100) NOT NULL,\n  type ENUM('agv', 'rtg', 'qc', 'asc', 'conveyor', 'pump', 'motor', 'sensor_hub', 'gateway', 'other') DEFAULT 'other' NOT NULL,\n  model VARCHAR(100),\n  manufacturer VARCHAR(100),\n  serialNumber VARCHAR(100),\n  location VARCHAR(255),\n  department VARCHAR(100),\n  status ENUM('online', 'offline', 'maintenance', 'error', 'unknown') DEFAULT 'unknown' NOT NULL,\n  lastHeartbeat TIMESTAMP NULL,\n  installDate TIMESTAMP NULL,\n  warrantyExpiry TIMESTAMP NULL,\n  metadata JSON,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL\n);\n\n-- 传感器表\nCREATE TABLE IF NOT EXISTS sensors (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  sensorId VARCHAR(64) NOT NULL UNIQUE,\n  deviceId VARCHAR(64) NOT NULL,\n  name VARCHAR(100) NOT NULL,\n  type ENUM('vibration', 'temperature', 'pressure', 'current', 'voltage', 'speed', 'position', 'humidity', 'flow', 'level', 'other') DEFAULT 'other' NOT NULL,\n  unit VARCHAR(20),\n  minValue INT,\n  maxValue INT,\n  warningThreshold INT,\n  criticalThreshold INT,\n  samplingRate INT DEFAULT 1000,\n  status ENUM('active', 'inactive', 'error') DEFAULT 'active' NOT NULL,\n  lastValue VARCHAR(50),\n  lastReadingAt TIMESTAMP NULL,\n  metadata JSON,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL\n);\n\n-- 遥测数据表\nCREATE TABLE IF NOT EXISTS sensor_readings (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  sensorId VARCHAR(64) NOT NULL,\n  deviceId VARCHAR(64) NOT NULL,\n  value VARCHAR(50) NOT NULL,\n  numericValue INT,\n  quality ENUM('good', 'uncertain', 'bad') DEFAULT 'good' NOT NULL,\n  timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  metadata JSON,\n  INDEX idx_sensor_time (sensorId, timestamp),\n  INDEX idx_device_time (deviceId, timestamp)\n);\n\n-- 聚合数据表\nCREATE TABLE IF NOT EXISTS sensor_aggregates (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  sensorId VARCHAR(64) NOT NULL,\n  deviceId VARCHAR(64) NOT NULL,\n  period ENUM('1m', '5m', '1h', '1d') NOT NULL,\n  periodStart TIMESTAMP NOT NULL,\n  avgValue INT,\n  minValue INT,\n  maxValue INT,\n  sumValue INT,\n  count INT DEFAULT 0 NOT NULL,\n  stdDev INT,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  INDEX idx_sensor_period (sensorId, period, periodStart)\n);\n\n-- 事件日志表\nCREATE TABLE IF NOT EXISTS event_logs (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  eventId VARCHAR(64) NOT NULL UNIQUE,\n  topic VARCHAR(100) NOT NULL,\n  eventType VARCHAR(50) NOT NULL,\n  source VARCHAR(100),\n  deviceId VARCHAR(64),\n  sensorId VARCHAR(64),\n  severity ENUM('info', 'warning', 'error', 'critical') DEFAULT 'info' NOT NULL,\n  payload JSON,\n  processed BOOLEAN DEFAULT FALSE NOT NULL,\n  processedAt TIMESTAMP NULL,\n  processedBy VARCHAR(100),\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  INDEX idx_topic (topic),\n  INDEX idx_device (deviceId),\n  INDEX idx_severity (severity)\n);\n\n-- 异常检测结果表\nCREATE TABLE IF NOT EXISTS anomaly_detections (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  detectionId VARCHAR(64) NOT NULL UNIQUE,\n  sensorId VARCHAR(64) NOT NULL,\n  deviceId VARCHAR(64) NOT NULL,\n  algorithmType ENUM('zscore', 'iqr', 'mad', 'isolation_forest', 'custom') DEFAULT 'zscore' NOT NULL,\n  windowSize INT DEFAULT 60,\n  threshold INT,\n  currentValue INT,\n  expectedValue INT,\n  deviation INT,\n  score INT,\n  severity ENUM('low', 'medium', 'high', 'critical') DEFAULT 'low' NOT NULL,\n  status ENUM('open', 'acknowledged', 'resolved', 'false_positive') DEFAULT 'open' NOT NULL,\n  acknowledgedBy VARCHAR(100),\n  acknowledgedAt TIMESTAMP NULL,\n  resolvedAt TIMESTAMP NULL,\n  notes TEXT,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  INDEX idx_sensor (sensorId),\n  INDEX idx_status (status),\n  INDEX idx_severity (severity)\n);\n\n-- 诊断规则表\nCREATE TABLE IF NOT EXISTS diagnosis_rules (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  ruleId VARCHAR(64) NOT NULL UNIQUE,\n  name VARCHAR(200) NOT NULL,\n  description TEXT,\n  category VARCHAR(50),\n  deviceType VARCHAR(50),\n  sensorType VARCHAR(50),\n  conditionExpr TEXT NOT NULL,\n  actionType ENUM('alert', 'notification', 'workflow', 'auto_fix') DEFAULT 'alert' NOT NULL,\n  actionConfig JSON,\n  severity ENUM('low', 'medium', 'high', 'critical') DEFAULT 'medium' NOT NULL,\n  isActive BOOLEAN DEFAULT TRUE NOT NULL,\n  priority INT DEFAULT 5,\n  triggerCount INT DEFAULT 0,\n  lastTriggeredAt TIMESTAMP NULL,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL\n);\n\n-- 诊断任务表\nCREATE TABLE IF NOT EXISTS diagnosis_tasks (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  taskId VARCHAR(64) NOT NULL UNIQUE,\n  deviceId VARCHAR(64),\n  sensorId VARCHAR(64),\n  ruleId VARCHAR(64),\n  anomalyId VARCHAR(64),\n  taskType ENUM('routine', 'anomaly', 'manual', 'scheduled') DEFAULT 'routine' NOT NULL,\n  status ENUM('pending', 'running', 'completed', 'failed', 'cancelled') DEFAULT 'pending' NOT NULL,\n  priority INT DEFAULT 5,\n  inputData JSON,\n  result JSON,\n  error TEXT,\n  startedAt TIMESTAMP NULL,\n  completedAt TIMESTAMP NULL,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  INDEX idx_device (deviceId),\n  INDEX idx_status (status)\n);\n",
  "returncode": 1,
  "logs": [
    "ERROR 1064 (42000) at line 23: You have an error in your SQL syntax; check the manual that corresponds to your TiDB version for the right syntax to use line 9 column 11 near \"maxValue INT,",
    "  warningThreshold INT,",
    "  criticalThreshold INT,",
    "  samplingRate INT DEFAULT 1000,",
    "  status ENUM('active', 'inactive', 'error') DEFAULT 'active' NOT NULL,",
    "  lastValue VARCHAR(50),",
    "  lastReadingAt TIMESTAMP NULL,",
    "  metadata JSON,",
    "  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,",
    "  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_T"
  ]
}