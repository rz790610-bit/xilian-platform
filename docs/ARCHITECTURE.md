# 西联智能平台架构文档

## 平台层级结构

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           用户交互层 (User Interaction Layer)                │
├─────────────────────────────────────────────────────────────────────────────┤
│  Web Portal  │  Mobile App  │  Voice UI  │  GraphQL Gateway  │  REST API   │
│  (React 19)  │  (预留)      │  (预留)    │  (预留)           │  (tRPC)     │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           API 网关层 (API Gateway Layer)                     │
├─────────────────────────────────────────────────────────────────────────────┤
│  Kong Gateway  │  Istio Service Mesh  │  Rate Limiting  │  Auth/OAuth      │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           业务服务层 (Business Service Layer)                │
├─────────────────────────────────────────────────────────────────────────────┤
│  设备管理     │  知识库管理   │  AI 模型管理  │  数据流管理   │  运维管理    │
│  DeviceService│  KBService    │  ModelService │  DataStream   │  OpsService  │
├─────────────────────────────────────────────────────────────────────────────┤
│  安全中心     │  边缘计算     │  诊断引擎     │  告警管理     │  拓扑管理    │
│  Security     │  EdgeCompute  │  Diagnosis    │  AlertManager │  Topology    │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           数据处理层 (Data Processing Layer)                 │
├─────────────────────────────────────────────────────────────────────────────┤
│  Kafka Streams  │  Flink Jobs  │  Airflow DAGs  │  Rust Modules  │  Go Services│
│  (消息队列)     │  (流处理)    │  (调度编排)    │  (高性能计算)  │  (高并发)   │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           数据存储层 (Data Storage Layer)                    │
├─────────────────────────────────────────────────────────────────────────────┤
│  MySQL/TiDB   │  ClickHouse   │  Neo4j        │  Qdrant       │  Redis      │
│  (关系数据)   │  (时序数据)   │  (图数据)     │  (向量数据)   │  (缓存)     │
├─────────────────────────────────────────────────────────────────────────────┤
│  MinIO/S3     │  Kafka        │  Elasticsearch │              │             │
│  (对象存储)   │  (消息存储)   │  (日志存储)    │              │             │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           基础设施层 (Infrastructure Layer)                  │
├─────────────────────────────────────────────────────────────────────────────┤
│  Kubernetes   │  Docker       │  Prometheus   │  Grafana      │  Vault      │
│  (容器编排)   │  (容器化)     │  (监控)       │  (可视化)     │  (密钥管理) │
├─────────────────────────────────────────────────────────────────────────────┤
│  Falco        │  Trivy        │  Semgrep      │  Gitleaks     │  Nginx      │
│  (运行时安全) │  (漏洞扫描)   │  (代码扫描)   │  (密钥检测)   │  (反向代理) │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                           边缘计算层 (Edge Computing Layer)                  │
├─────────────────────────────────────────────────────────────────────────────┤
│  Edge Gateway │  TensorRT-LLM │  5G TSN       │  MQTT/OPC-UA  │  Modbus     │
│  (边缘网关)   │  (边缘推理)   │  (低延迟通信) │  (协议适配)   │  (工业协议) │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 模块目录结构

```
xilian-platform/
├── client/                     # 前端应用
│   ├── src/
│   │   ├── pages/              # 页面组件
│   │   │   ├── device/         # 设备管理页面
│   │   │   ├── security/       # 安全中心页面
│   │   │   ├── edge/           # 边缘计算页面
│   │   │   └── services/       # 微服务页面
│   │   ├── components/         # 通用组件
│   │   └── config/             # 配置文件
│   └── public/                 # 静态资源
│
├── server/                     # 后端服务
│   ├── _core/                  # 核心框架
│   ├── device/                 # 设备管理服务
│   ├── ops/                    # 运维管理服务
│   ├── cache/                  # 缓存服务
│   ├── database/               # 数据库优化
│   ├── gateway/                # API 网关
│   ├── knowledge/              # 知识库服务
│   ├── observability/          # 可观测性服务
│   └── rust/                   # Rust 桥接层
│
├── src/                        # 扩展模块
│   ├── go-services/            # Go 高并发服务
│   │   ├── sensor-ingestion/   # 数据摄入服务
│   │   ├── realtime-aggregator/# 实时聚合服务
│   │   └── event-dispatcher/   # 事件分发服务
│   ├── rust-modules/           # Rust 性能模块
│   │   ├── signal-processor/   # 信号处理模块
│   │   └── data-aggregator/    # 数据聚合模块
│   ├── ops/                    # 运维模块
│   │   ├── dashboard/          # 监控仪表盘
│   │   ├── automation/         # 自动化运维
│   │   └── edge/               # 边缘计算
│   └── security/               # 安全模块
│       ├── falco/              # Falco 运行时安全
│       ├── scanner/            # 安全扫描器
│       └── vault/              # Vault 密钥管理
│
├── k8s/                        # Kubernetes 配置
│   ├── security/               # 安全组件部署
│   ├── services/               # 微服务部署
│   └── edge/                   # 边缘组件部署
│
├── deploy/                     # 本地化部署
│   ├── docker/                 # Docker Compose
│   ├── scripts/                # 部署脚本
│   └── docs/                   # 部署文档
│
├── drizzle/                    # 数据库 Schema
└── shared/                     # 共享类型
```

## 模块依赖关系

```
                    ┌─────────────┐
                    │   client    │
                    │  (React)    │
                    └──────┬──────┘
                           │ tRPC
                           ▼
                    ┌─────────────┐
                    │   server    │
                    │  (Express)  │
                    └──────┬──────┘
                           │
          ┌────────────────┼────────────────┐
          │                │                │
          ▼                ▼                ▼
    ┌───────────┐   ┌───────────┐   ┌───────────┐
    │  device   │   │    ops    │   │ security  │
    │  service  │   │  service  │   │  service  │
    └─────┬─────┘   └─────┬─────┘   └─────┬─────┘
          │               │               │
          └───────────────┼───────────────┘
                          │
          ┌───────────────┼───────────────┐
          │               │               │
          ▼               ▼               ▼
    ┌───────────┐   ┌───────────┐   ┌───────────┐
    │  MySQL    │   │ ClickHouse│   │   Redis   │
    │  (关系)   │   │  (时序)   │   │  (缓存)   │
    └───────────┘   └───────────┘   └───────────┘
```

## 数据流向

```
传感器数据流:
  边缘设备 → MQTT/OPC-UA → Kafka → Flink → ClickHouse
                                      ↓
                                   MySQL (元数据)
                                      ↓
                                   Redis (缓存)
                                      ↓
                                   前端展示

告警数据流:
  异常检测 → Kafka → AlertManager → 通知渠道
                         ↓
                      MySQL (告警记录)
                         ↓
                      前端告警面板

AI 推理流:
  用户请求 → API → AI Engine → LLM/Embedding
                       ↓
                   知识库检索
                       ↓
                   响应生成
```

## 技术栈总览

| 层级 | 技术 | 用途 |
|------|------|------|
| 前端 | React 19 + Tailwind 4 + shadcn/ui | 用户界面 |
| 后端 | Express + tRPC + Drizzle ORM | API 服务 |
| 数据库 | MySQL + ClickHouse + Redis | 数据存储 |
| 消息队列 | Kafka + Zookeeper | 事件驱动 |
| 容器化 | Docker + Kubernetes | 部署运行 |
| 监控 | Prometheus + Grafana | 可观测性 |
| 安全 | Vault + Falco + Trivy | 安全防护 |
| 边缘 | TensorRT-LLM + 5G TSN | 边缘计算 |
| 高性能 | Rust + Go | 性能优化 |
